{"ast":null,"code":"import _slicedToArray from \"/Users/Macbook/WebstormProjects/mfg-4b-sz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/Macbook/WebstormProjects/mfg-4b-sz/src/components/Store/Ordering/Cooking.js\";\nimport React, { useCallback, useEffect, useMemo } from 'react';\nimport { AddBox, ArrowUpward } from \"@material-ui/icons\";\nimport { Button } from '@material-ui/core';\nimport Chip from '@material-ui/core/Chip';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MaterialTable from 'material-table';\nimport axios from './../../../api/axiosClient';\nimport { useStateValue } from './../../../global/state';\nconst useStyles = makeStyles(theme => ({\n  clicked: {\n    disabled: true\n  },\n  button: {\n    margin: theme.spacing(0.5),\n    whiteSpace: 'nowrap'\n  },\n  chip: {\n    margin: theme.spacing(0.5),\n    backgroundColor: '#e31b2f',\n    color: 'white'\n  },\n  close: {\n    padding: theme.spacing(0.5)\n  }\n}));\n\nconst Cooking = props => {\n  const classes = useStyles();\n  const columnMetaData = [\n  /*\n  {\n      title: 'Action',\n      field: 'action',\n      render: props => (\n          <div>\n              <Button\n                  variant=\"contained\"\n                  color=\"primary\"\n                  className={classes.button}\n                  onClick={(e,rowData) => {\n                      console.log('cooking button clicked');\n                      console.log(e);\n                      console.log(rowData);\n                  }} //props.onChange(e.target.value)\n              >\n                  Ready to pickup\n              </Button>\n          </div>\n      ),\n       cellStyle: {\n          padding: '3px 1px 3px 1px',\n      }\n  },\n  */\n  {\n    title: 'Id',\n    field: 'databaseId',\n    hidden: true\n  }, {\n    title: 'Status',\n    field: 'status',\n    cellStyle: {\n      //backgroundColor: '#e31b2f',\n      //color: 'white'\n      textAlign: 'center',\n      padding: '1px 1px 1px 1px'\n    },\n    render: props => React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 77\n      },\n      __self: this\n    }, React.createElement(Chip, {\n      label: \"Cooking\",\n      className: classes.chip,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 78\n      },\n      __self: this\n    }))\n  }, {\n    title: 'Order ID',\n    field: 'orderName' //lookup: { 34: 'İstanbul', 63: 'Şanlıurfa' },\n\n  }, {\n    title: 'Order Time',\n    field: 'orderTime',\n    type: 'datetime',\n    cellStyle: {\n      padding: '1px 1px 1px 1px'\n    }\n  }, {\n    title: 'Remark',\n    field: 'future',\n    cellStyle: {\n      padding: '1px 1px 1px 1px'\n    }\n  }, {\n    title: 'Gross Total',\n    field: 'grossTotal',\n    type: 'currency',\n    currencySetting: {\n      currencyCode: 'THB'\n    }\n  }]; //Global state\n\n  const _useStateValue = useStateValue(),\n        _useStateValue2 = _slicedToArray(_useStateValue, 2),\n        _useStateValue2$ = _useStateValue2[0],\n        appState = _useStateValue2$.appState,\n        dataState = _useStateValue2$.dataState,\n        dispatch = _useStateValue2[1]; //Local state     //const [intervalId,setIntervalId] = React.useState();\n  //Hook use Local state\n\n\n  const _React$useState = React.useState({\n    columns: columnMetaData,\n    data: [//{ status: 'cooking', future: '2019-07-17 13:30:15' , orderTime: '2019-07-17 13:00:15',storeName: 'Lab Avani', orderName: 'TPC ref 12345', grossTotal: \"323.25\", refID: \"12345\" },\n    ]\n  }),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        state = _React$useState2[0],\n        setState = _React$useState2[1];\n\n  const _React$useState3 = React.useState(false),\n        _React$useState4 = _slicedToArray(_React$useState3, 2),\n        isLoading = _React$useState4[0],\n        setIsLoading = _React$useState4[1]; //Data isloading when button has beenclicked\n\n\n  const _React$useState5 = React.useState(''),\n        _React$useState6 = _slicedToArray(_React$useState5, 2),\n        msg = _React$useState6[0],\n        setMsg = _React$useState6[1];\n\n  const _React$useState7 = React.useState(false),\n        _React$useState8 = _slicedToArray(_React$useState7, 2),\n        open = _React$useState8[0],\n        setOpen = _React$useState8[1];\n\n  function handleClose(event, reason) {\n    if (reason === 'clickaway') {\n      return;\n    }\n\n    setMsg('');\n    setOpen(false);\n  } //loading data every interval\n\n\n  useEffect(() => {\n    async function freshOrdersInStore() {\n      let get_url = '/api/v1/store/orders/1112delivery/' + appState.sitegroup + '/' + appState.store;\n      console.group('GET ' + get_url);\n      console.groupEnd();\n      await axios.get(get_url).then(response => {\n        if (response.data) {\n          var results = response.data;\n          console.group('API return :');\n          console.log(results);\n          console.groupEnd();\n\n          if (results.length > 0) {\n            dispatch({\n              type: 'FRESH_ORDER_INSTORE_SUCCESS',\n              data: results\n            });\n          }\n\n          console.group('GlobalStateObject');\n          console.log(appState);\n          console.log(dataState);\n          console.groupEnd();\n        }\n      }).then(() => {\n        if (dataState.order_instore.length > state.data.length) {\n          let diff = dataState.order_instore.length - state.data.length;\n          setMsg('You have ' + diff + ' order(s)');\n        }\n      }).then(() => {\n        if (msg.length > 0) {\n          setOpen(true);\n        }\n      }).then(async () => {\n        console.group('Rerender data table list');\n        console.log(dataState.order_instore.length + ' record(s)');\n        console.groupEnd(); //Map data appstate to cooking line\n\n        var orders = dataState.order_instore.length > 0 ? [...dataState.order_instore] : [];\n        var cookingOrders = orders.filter(order => {\n          return (order.cookingFinishTime === null || order.cookingFinishTime == '') && (order.pickupFinishTime === null || order.pickupFinishTime == '');\n        }); //console.log(cookingOrders);\n\n        const cookingRows = cookingOrders.map(row => {\n          var raw = JSON.parse(row.json);\n          return {\n            databaseId: row.id,\n            status: 'cooking',\n            orderName: row.orderName,\n            orderTime: row.tranDate,\n            future: row.orderType == 0 ? '' : row.dueDate,\n            grossTotal: raw.SDM.GrossTotal\n          };\n        });\n        console.group('DataTable StateObject');\n        console.log(cookingRows);\n        console.groupEnd();\n        await setState({\n          columns: columnMetaData,\n          data: cookingRows\n        });\n      }).then(() => {}).catch(error => {\n        console.log('API error ,could not get data ' + error);\n      });\n    }\n\n    freshOrdersInStore();\n    let id = setInterval(function () {\n      freshOrdersInStore();\n    }, dataState.interval); //setIntervalId(id);\n\n    return function cleanup() {\n      clearInterval(id);\n    };\n  }, []); //Map rows of freshing database to data table list to display\n  //useMemo(() => {\n  //},[appState.order_instore]);\n\n  /*\n  useEffect(() => {\n      function handleStatusChange(status) {\n        setIsOnline(status.isOnline);\n      }\n       //[componentWillMount ,componentDidMount ,componentDidUpdate]\n      ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n       //[componentWillUnmount()]\n      // Specify how to clean up after this effect:\n      return function cleanup() {\n        ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n      };\n    });\n     .MuiTableCell-sizeSmall {\n          padding: 1px 1px 1px 1px;\n      }\n    */\n\n  async function readyToPickupHandle(id, orderId) {\n    let put_url = '/api/v1/store/order/1112delivery/' + id + '/cooking';\n    console.group('PUT ' + put_url);\n    console.groupEnd();\n    await axios.put(put_url, {\n      orderName: orderId\n    }).then(response => {\n      var results = response.data;\n      console.group('API return :');\n      console.log(results);\n      console.groupEnd();\n      /*\n      if (results.length > 0 ) {\n          dispatch({\n              type: 'READY_PICKUP_SUCCESS',\n              data: orderId\n          });\n      }*/\n\n      var copyState = [...state.data];\n      var removed = copyState.filter(order => {\n        return order.databaseId != id;\n      });\n      console.group('Removed row ' + id);\n      console.groupEnd();\n      setState({\n        columns: columnMetaData,\n        data: removed\n      });\n      setIsLoading(false);\n      console.group('DataTable StateObject');\n      console.log(removed);\n      console.groupEnd();\n    }).catch(error => {\n      console.log('API error ,could not put data ' + error);\n    });\n  }\n\n  return React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291\n    },\n    __self: this\n  }, React.createElement(MaterialTable, {\n    title: \"Cooking\",\n    isLoading: isLoading,\n    columns: state.columns,\n    data: state.data,\n    actions: [rowData => ({\n      icon: () => {\n        return React.createElement(Button, {\n          variant: \"contained\",\n          color: \"primary\",\n          className: classes.button,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 301\n          },\n          __self: this\n        }, \"Ready to pickup\");\n      },\n      tooltip: 'Ready to Pickup',\n      onClick: (event, rowData) => {\n        setIsLoading(true);\n        readyToPickupHandle(rowData.databaseId, rowData.orderName);\n      }\n    })],\n    actionsColumnIndex: \"1\",\n    filtering: \"true\",\n    options: {\n      padding: 'dense',\n      pageSize: 10,\n      search: false,\n      showTitle: false,\n      //rowStyle: { backgroundColor: 'green'},\n      rowStyle: rowData => {\n        //if(rowData.status === \"\") {\n        //    return {backgroundColor: 'red'};\n        //}\n        return {};\n      }\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 292\n    },\n    __self: this\n  }), React.createElement(Snackbar, {\n    anchorOrigin: {\n      vertical: 'bottom',\n      horizontal: 'left'\n    },\n    open: open,\n    autoHideDuration: 6000,\n    onClose: handleClose,\n    ContentProps: {\n      'aria-describedby': 'message-id'\n    },\n    message: React.createElement(\"span\", {\n      id: \"message-id\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345\n      },\n      __self: this\n    }, \"Note archived\"),\n    action: [React.createElement(IconButton, {\n      key: \"close\",\n      \"aria-label\": \"close\",\n      color: \"inherit\",\n      className: classes.close,\n      onClick: handleClose,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347\n      },\n      __self: this\n    }, React.createElement(CloseIcon, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 354\n      },\n      __self: this\n    }))],\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 334\n    },\n    __self: this\n  }));\n};\n\nexport default Cooking;","map":{"version":3,"sources":["/Users/Macbook/WebstormProjects/mfg-4b-sz/src/components/Store/Ordering/Cooking.js"],"names":["React","useCallback","useEffect","useMemo","AddBox","ArrowUpward","Button","Chip","Snackbar","IconButton","CloseIcon","makeStyles","MaterialTable","axios","useStateValue","useStyles","theme","clicked","disabled","button","margin","spacing","whiteSpace","chip","backgroundColor","color","close","padding","Cooking","props","classes","columnMetaData","title","field","hidden","cellStyle","textAlign","render","type","currencySetting","currencyCode","appState","dataState","dispatch","useState","columns","data","state","setState","isLoading","setIsLoading","msg","setMsg","open","setOpen","handleClose","event","reason","freshOrdersInStore","get_url","sitegroup","store","console","group","groupEnd","get","then","response","results","log","length","order_instore","diff","orders","cookingOrders","filter","order","cookingFinishTime","pickupFinishTime","cookingRows","map","row","raw","JSON","parse","json","databaseId","id","status","orderName","orderTime","tranDate","future","orderType","dueDate","grossTotal","SDM","GrossTotal","catch","error","setInterval","interval","cleanup","clearInterval","readyToPickupHandle","orderId","put_url","put","copyState","removed","rowData","icon","tooltip","onClick","pageSize","search","showTitle","rowStyle","vertical","horizontal"],"mappings":"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","sourcesContent":["import React, {useCallback, useEffect ,useMemo} from 'react';\n\nimport { AddBox, ArrowUpward } from \"@material-ui/icons\";\nimport { Button } from '@material-ui/core'\nimport Chip from '@material-ui/core/Chip';\nimport Snackbar from '@material-ui/core/Snackbar';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { makeStyles } from '@material-ui/core/styles';\nimport MaterialTable from 'material-table';\nimport axios from './../../../api/axiosClient';\nimport {useStateValue} from './../../../global/state'\n\n\nconst useStyles = makeStyles(theme => ({\n    clicked: {\n        disabled: true,\n    },\n    button: {\n        margin: theme.spacing(0.5),\n        whiteSpace: 'nowrap'\n    },\n    chip: {\n        margin: theme.spacing(0.5),\n        backgroundColor: '#e31b2f',\n        color: 'white'\n    },\n    close: {\n        padding: theme.spacing(0.5),\n    },\n}));\n\nconst Cooking = (props) => {\n    const classes = useStyles();\n    const columnMetaData = [\n        /*\n        {\n            title: 'Action',\n            field: 'action',\n            render: props => (\n                <div>\n                    <Button\n                        variant=\"contained\"\n                        color=\"primary\"\n                        className={classes.button}\n                        onClick={(e,rowData) => {\n                            console.log('cooking button clicked');\n                            console.log(e);\n                            console.log(rowData);\n                        }} //props.onChange(e.target.value)\n                    >\n                        Ready to pickup\n                    </Button>\n                </div>\n            ),\n\n            cellStyle: {\n                padding: '3px 1px 3px 1px',\n            }\n        },\n        */\n        {\n            title: 'Id',\n            field: 'databaseId',\n            hidden: true\n        },\n        {\n            title: 'Status',\n            field: 'status',\n            cellStyle: {\n                //backgroundColor: '#e31b2f',\n                //color: 'white'\n                textAlign: 'center',\n                padding: '1px 1px 1px 1px',\n            },\n            render: props => (\n                <div>\n                    <Chip label=\"Cooking\" className={classes.chip}  />\n                </div>\n            ),\n        },\n        {\n            title: 'Order ID',\n            field: 'orderName',\n            //lookup: { 34: 'İstanbul', 63: 'Şanlıurfa' },\n\n        },\n        { title: 'Order Time' ,\n            field: 'orderTime',\n            type: 'datetime',\n            cellStyle: {\n                padding: '1px 1px 1px 1px',\n            }\n        },\n        { title: 'Remark',\n            field: 'future',\n            cellStyle: {\n                padding: '1px 1px 1px 1px',\n            }\n        },\n        { title: 'Gross Total',\n            field: 'grossTotal',\n            type: 'currency' ,\n            currencySetting: {\n                currencyCode: 'THB'\n            }\n\n        },\n    ];\n\n    //Global state\n    const [{ appState ,dataState }, dispatch] = useStateValue();\n\n    //Local state     //const [intervalId,setIntervalId] = React.useState();\n    //Hook use Local state\n    const [state, setState] = React.useState({\n        columns: columnMetaData,\n        data: [\n            //{ status: 'cooking', future: '2019-07-17 13:30:15' , orderTime: '2019-07-17 13:00:15',storeName: 'Lab Avani', orderName: 'TPC ref 12345', grossTotal: \"323.25\", refID: \"12345\" },\n        ],\n    });\n    const [isLoading,setIsLoading] = React.useState(false);  //Data isloading when button has beenclicked\n    const [msg,setMsg] = React.useState('');\n    const [open, setOpen] = React.useState(false);\n    function handleClose(event, reason) {\n        if (reason === 'clickaway') {\n            return;\n        }\n        setMsg('');\n        setOpen(false);\n    }\n\n    //loading data every interval\n    useEffect(() => {\n        async function freshOrdersInStore() {\n            let get_url = '/api/v1/store/orders/1112delivery/'+appState.sitegroup+'/'+appState.store\n            console.group('GET '+get_url);\n            console.groupEnd();\n            await axios.get(get_url)\n                .then((response)=>{\n                    if(response.data){\n                        var results = response.data;\n                        console.group('API return :');\n                        console.log(results);\n                        console.groupEnd();\n\n                        if (results.length > 0 ) {\n                            dispatch({\n                                type: 'FRESH_ORDER_INSTORE_SUCCESS',\n                                data: results\n                            });\n                        }\n                        console.group('GlobalStateObject');\n                        console.log(appState);\n                        console.log(dataState);\n                        console.groupEnd();\n                    }\n                })\n                .then(() => {\n\n                    if(dataState.order_instore.length > state.data.length){\n                        let diff = dataState.order_instore.length - state.data.length;\n                        setMsg('You have '+diff+' order(s)');\n                    }\n                })\n                .then(() => {\n                    if(msg.length > 0){\n                        setOpen(true);\n                    }\n                })\n                .then(async () =>{\n                    console.group('Rerender data table list');\n                    console.log(dataState.order_instore.length + ' record(s)')\n                    console.groupEnd();\n                    //Map data appstate to cooking line\n                    var orders = dataState.order_instore.length > 0 ? [...dataState.order_instore] : [];\n                    var cookingOrders = orders.filter(order => {\n                        return (order.cookingFinishTime === null || order.cookingFinishTime == '')\n                            && (order.pickupFinishTime === null || order.pickupFinishTime == '')\n                    });\n                    //console.log(cookingOrders);\n\n                    const cookingRows = cookingOrders.map(row => {\n                        var raw =  JSON.parse(row.json);\n                        return {\n                            databaseId: row.id,\n                            status: 'cooking',\n                            orderName: row.orderName,\n                            orderTime: row.tranDate,\n                            future: row.orderType == 0 ? '' : row.dueDate,\n                            grossTotal: raw.SDM.GrossTotal\n                        }\n                    });\n\n                    console.group('DataTable StateObject');\n                    console.log(cookingRows);\n                    console.groupEnd();\n\n                    await setState({\n                        columns: columnMetaData,\n                        data: cookingRows\n                    });\n\n                })\n                .then(() => {\n\n                })\n                .catch((error)=>{\n                console.log('API error ,could not get data '+error )\n                })\n        }\n\n        freshOrdersInStore();\n        let id = setInterval(function () {\n            freshOrdersInStore();\n        },dataState.interval)\n        //setIntervalId(id);\n\n        return function cleanup() {\n            clearInterval(id);\n        };\n    },[]);\n\n    //Map rows of freshing database to data table list to display\n    //useMemo(() => {\n    //},[appState.order_instore]);\n\n    /*\n    useEffect(() => {\n        function handleStatusChange(status) {\n          setIsOnline(status.isOnline);\n        }\n\n        //[componentWillMount ,componentDidMount ,componentDidUpdate]\n        ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange);\n\n        //[componentWillUnmount()]\n        // Specify how to clean up after this effect:\n        return function cleanup() {\n          ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange);\n        };\n      });\n\n      .MuiTableCell-sizeSmall {\n            padding: 1px 1px 1px 1px;\n        }\n      */\n\n    async function readyToPickupHandle(id ,orderId) {\n        let put_url = '/api/v1/store/order/1112delivery/'+id+'/cooking';\n        console.group('PUT '+put_url);\n        console.groupEnd();\n        await axios.put(put_url,{\n            orderName: orderId\n        }).then((response) => {\n            var results = response.data;\n            console.group('API return :');\n            console.log(results);\n            console.groupEnd();\n\n            /*\n            if (results.length > 0 ) {\n                dispatch({\n                    type: 'READY_PICKUP_SUCCESS',\n                    data: orderId\n                });\n            }*/\n\n            var copyState = [...state.data];\n            var removed = copyState.filter(order =>{\n                return order.databaseId != id;\n            })\n            console.group('Removed row '+id);\n            console.groupEnd();\n\n            setState({\n                columns: columnMetaData,\n                data: removed\n            });\n            setIsLoading(false);\n\n            console.group('DataTable StateObject');\n            console.log(removed);\n            console.groupEnd();\n        }).catch((error)=>{\n            console.log('API error ,could not put data '+error )\n        })\n    }\n\n    return (\n        <div>\n            <MaterialTable\n                title=\"Cooking\"\n                isLoading={isLoading}\n                columns={state.columns}\n                data={state.data}\n                actions={[\n                    rowData => ({\n                         icon: () => {\n                             return (\n                                 <Button\n                                     variant=\"contained\"\n                                     color=\"primary\"\n                                     className={classes.button}\n                                 >\n                                     Ready to pickup\n                                 </Button>\n                             );\n                         },\n                         tooltip: 'Ready to Pickup',\n                         onClick: (event,rowData) => {\n                             setIsLoading(true);\n                             readyToPickupHandle(rowData.databaseId,rowData.orderName);\n                         }\n                    })\n                ]}\n                actionsColumnIndex=\"1\"\n                filtering='true'\n                options={{\n                    padding: 'dense',\n                    pageSize: 10,\n                    search: false,\n                    showTitle: false,\n                    //rowStyle: { backgroundColor: 'green'},\n                    rowStyle: rowData => {\n                        //if(rowData.status === \"\") {\n                        //    return {backgroundColor: 'red'};\n                        //}\n                        return {};\n                    }\n                }}\n\n            />\n            <Snackbar\n                anchorOrigin={{\n                    vertical: 'bottom',\n                    horizontal: 'left',\n                }}\n                open={open}\n                autoHideDuration={6000}\n                onClose={handleClose}\n                ContentProps={{\n                    'aria-describedby': 'message-id',\n                }}\n                message={<span id=\"message-id\">Note archived</span>}\n                action={[\n                    <IconButton\n                        key=\"close\"\n                        aria-label=\"close\"\n                        color=\"inherit\"\n                        className={classes.close}\n                        onClick={handleClose}\n                    >\n                        <CloseIcon />\n                    </IconButton>,\n                ]}\n            />\n        </div>\n    );\n};\n\nexport default Cooking;"]},"metadata":{},"sourceType":"module"}